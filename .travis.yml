# use miniconda for python, so don't specify "python", which doesn't
# work on travis osx anyway
language: generic
os:
  - linux
  - osx
  # TODO: windows CI (not currently supported by travis)

env:
  matrix:
    - QPYVER=2.7
    - QPYVER=3.4
    - QPYVER=3.5
    - QPYVER=3.6

matrix:
  include:
    - os: linux
      python: '3.6'
      env: NO_CONDA=true

before_install:
  # miniconda for mac
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
      curl -o mconda.sh https://repo.continuum.io/miniconda/Miniconda3-latest-MacOSX-x86_64.sh;
    fi
  # miniconda for linux
  - if [[ "$TRAVIS_OS_NAME" == "linux" ] && ["$NO_CONDA" -ne "true"]]; then
        curl -o mconda.sh https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh;
        chmod +x mconda.sh;
        ./mconda.sh -b;
        export PATH="/home/travis/miniconda3/bin:$PATH";
    fi
  # add anaconda to PATH
  # update conda (optional?)
  # - conda update --yes conda

install:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ] && ["$NO_CONDA" -ne "true"]]; then
      conda create --yes -n quilt_env python=$QPYVER pip;
      source activate quilt_env;
      conda install --yes -c conda-forge pyarrow=0.3;
    fi
  - echo $(python --version)
  # pytest
  - pip install pytest
  # install quilt from setup.py
  - travis_retry pip install .

script:
  - pytest
