# use miniconda for python, so don't specify "python", which doesn't
# work on travis osx anyway
language: c
os:
  - linux
  - osx
  # TODO: windows CI (not currently supported by travis)

env:
  matrix:
    - QPYVER=2.7
    - QPYVER=3.4
    - QPYVER=3.5
    - QPYVER=3.6

before_install:
  # brew update (do we *really* need this? it's slow. travis recommends this https://docs.travis-ci.com/user/osx-ci-environment/
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then travis_retry brew update; fi
  # osx needs wget
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install wget; fi
  # miniconda for mac
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then curl -o mconda.sh https://repo.continuum.io/miniconda/Miniconda3-latest-MacOSX-x86_64.sh; fi
  # miniconda for linux
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then curl -o mconda.sh https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh; fi
  # install miniconda
  - chmod +x mconda.sh
  - ./mconda.sh -b
  # add anaconda to PATH
  - export PATH="/home/travis/anaconda/bin:$PATH"
  # update conda
  # - conda update --yes conda

install:
  # create conda evn
  - conda create --yes -n quilt_env python=$QPYVER pip
  - source activate quilt_env
  - echo $(python --version)
  # install pyarrow 0.3
  - conda install -c conda-forge pyarrow=0.3
  # pytest
  - pip install pytest
  # install quilt from setup.py
  - travis_retry pip install .

script:
  - pytest
